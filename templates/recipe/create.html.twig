{% extends 'base.html.twig' %}

{% block title %}New Recipe{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('ingredientList') }}
{% endblock %}

{% block body %}
    <div class="container mx-auto p-4 max-w-2xl">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Add New Recipe</h1>

        {{ form_start(form, {'attr': {'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}

        <div class="space-y-6">

            {# --- Recipe Details --- #}
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Recipe Details</h2>
                <div class="space-y-4">
                    {{ form_row(form.title) }}
                    {{ form_row(form.description) }}
                    <div class="grid grid-cols-2 gap-4">
                        {{ form_row(form.prepTime) }}
                        {{ form_row(form.cookTime) }}
                    </div>
                    {{ form_row(form.image) }}
                </div>
            </div>

            {# --- Ingredients List (Collection) --- #}
            <div class="bg-white p-6 rounded-lg shadow-md" id="ingredients-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Ingredients List</h2>

                {# This is the parent container for the dynamic collection #}
                <div
                    id="ingredient-fields-list"
                    data-prototype="{{ form_widget(form.recipeIngredients.vars.prototype)|e('html_attr') }}"
                    data-index="{{ form.recipeIngredients|length }}"
                >
                    {% for ingredientField in form.recipeIngredients %}
                        {# UPDATED GRID LAYOUT FOR INGREDIENT FIELDS #}
                        <div
                            class="ingredient-item bg-gray-50 p-4 rounded-lg mb-3 flex items-start space-x-3 border border-gray-200">

                            {# Use a grid/flex layout for better organization inside the row #}
                            <div class="grid grid-cols-5 gap-3 flex-grow space-y-0">
                                {# Ingredient Name takes 3/5 space #}
                                <div class="col-span-3">
                                    {{ form_row(ingredientField.ingredient) }}
                                </div>
                                {# Quantity takes 1/5 space #}
                                <div class="col-span-1">
                                    {{ form_row(ingredientField.quantity) }}
                                </div>
                                {# Unit takes 1/5 space #}
                                <div class="col-span-1">
                                    {{ form_row(ingredientField.unit) }}
                                </div>
                            </div>

                            <button type="button"
                                    class="remove-ingredient-btn text-red-500 hover:text-red-700 mt-2 p-1 rounded-full hover:bg-red-100 transition duration-150"
                                    aria-label="Remove ingredient">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3"></path>
                                </svg>
                            </button>
                        </div>
                    {% endfor %}
                </div>

                <button type="button"
                        id="add-ingredient-button"
                        class="mt-4 w-full px-4 py-2 bg-[#9b59b6] text-white font-semibold rounded-lg hover:bg-[#834ea2] transition duration-300 shadow-md flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Add Ingredient
                </button>
            </div>

            <button type="submit"
                    class="w-full py-3 bg-[#4CAF50] text-white font-bold text-xl rounded-lg hover:bg-[#388E3C] transition duration-300 shadow-xl">
                Save Recipe
            </button>
        </div>

        {{ form_rest(form) }}
        {{ form_end(form) }}

    </div>
{% endblock %}
